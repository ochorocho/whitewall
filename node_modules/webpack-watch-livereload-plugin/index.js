var livereload = require('livereload');


function WatchLiveReloadPlugin(options) {
	this.options = options || {};
	this.files = this.options.files || '';
	this.port = this.options.port || 35729;
	this.server = null;
}


Object.defineProperty(WatchLiveReloadPlugin.prototype, 'isRunning', {
	get: function() {
		return !!this.server;
	}
});


WatchLiveReloadPlugin.prototype.apply = function apply(compiler) {
	var self = this;
	self.compiler = compiler;
	compiler.plugin('watch-run', function(watching, callback) {
		if (!self.isRunning) {
			self.server = livereload.createServer();
			self.server.watch(self.files);
			console.log('LiveReload server running on port', self.port);
		}
		callback();
	});
};


module.exports = WatchLiveReloadPlugin;
